---
title: Trends in the prescribing of antihypertensive medications â€“ can we see higher
  prescribing in areas with an older demographic and reduced cardiovascular health
  outcomes?
author: "Brian Kim"
date: "2024-11-01"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warnings=FALSE)
```

## R Markdown

My topic wanted to explore whether there weas trend in antihypertensive medication (higher prscribing in areas with older demographic and whether the cardiovascular health outcome was removed). However due to R crashing everytime I would try to join the datasets (prescription with heart disease outcome, or linking council area by HB), I was not able to formulate a graph at this point. 

First filtering for drug, there is too many different types of antihypertensive to cover everything. Thus, we're specifically going to look at brand name and drug name for Calcium channel blockers. Calcium channel blockers can reduce blood pressure by dilating the arteries and, in some cases, reducing the force of the heart's contractions. becausedata set seem to have both brand and drug name.

#
Here are a few points to consider as you continue to work on this:

- For reproducibility, please make sure to explain where the various datasets came from. Where possible, load the data straight from URL. 

- Consider using read_csv() rather than read.csv(), to consistently stay within the tidyverse

- When loading libraries, avoid redundancy (e.g. ggplot2 is part of the tidyverse, so you don't need to load it separately)

- Make sure that your code doesn't run off the page (this should be less of an issue when you render to HTML)
#
  
```{r cars}
#Loading required stuff
library(dplyr)
library(tidyverse)
library(janitor)
library(gt)
library(stringr)
library(here)

prescriptions <- read_csv("/Users/Studnet Data/Year 4/data_science/B138584/data/oct2022per.csv") %>% 
  clean_names()
gp_demographic_data <- read_csv("/Users/Studnet Data/Year 4/data_science/B138584/data/GPDemographic2022oct.csv") %>% 
  clean_names()
heart_mortality <- read_csv("/Users/Studnet Data/Year 4/data_science/B138584/data/HeartDiseaseMortality.csv") %>% 
  clean_names()
CA_HB <- read_csv("/Users/Studnet Data/Year 4/data_science/B138584/data/CA:HB_CODES.csv") %>% 
  clean_names()
Healthboards_name <- read_csv(here("/Users/Studnet Data/Year 4/data_science/week_7_thurs/Healthboard.csv")) %>%
  clean_names()

#filtering out hypertension drug (onward is still code but I've left it not as code cause of syntax error)

calcium_channel_blockers <- c("Norvasc", "Amlodipine", "Diltiazem", "Cardizem", "Tiazac", "Plendil", "Felodipine", "DynaCirc", "Isradipine", "Cardene", "Nicardipine", "Sular", "Nisoldipine",  "Verelan", "Covera HS", "Isoptin SR", "Verapamil", "Procardia XL", "Adalat CC", "Nifedipine") %>% 
  toupper()

paste(calcium_channel_blockers, collapse = "|")

filtered_data <- prescriptions %>% 
  filter(str_detect(bnf_item_description, paste(calcium_channel_blockers, collapse = "|"))) %>% 
  filter(hbt != "SB0806") %>% 
  select(gp_practice, hbt, bnf_item_description, paid_quantity)


#filtering for age 65+ in GP demographic data then joining to perscription

gp_2 <- gp_demographic_data %>% 
  mutate(over_65 = ages65to74 + ages75to84 + ages85plus) %>%   
  select(practice_code, hb, hscp, over_65) %>%  
  group_by(practice_code) %>% 
  summarise(over_65_total = sum(over_65, na.rm = TRUE)) 
prescriptions_age <- filtered_data %>% 
  left_join(gp_2, by = join_by(gp_practice == practice_code)) 

#adding HB name
New_HB_name <- Healthboards_name %>% 
  rename(hbt = hb) %>% 
  select(hbt, hb_name)

joined_data <- prescriptions_age %>% 
  left_join(New_HB_name, join_by(hbt))

#joining Council area by healthboard code

CA_HB_2 <- CA_HB %>% 
  select(hb_name, ca_name) %>% 
  group_by(hb_name) %>% 
  summarize(council_area = paste(unique(ca_name), collapse = ", "))

prescriptions_age_ca <- joined_data %>% 
  left_join(CA_HB_2, by = join_by(hb_name))
            
#joining heart disease outcome by hb code

Heart2 <- heart_mortality %>% 
  select(year, hbr, number_of_deaths, age_group) %>% 
  filter(grepl('75plus years|65-74 years', age_group)) %>% 
  filter(year == 2022) %>% 
  group_by(hbr) %>% 
  summarise(over_65_total_death = sum(number_of_deaths, na.rm = TRUE)) 
joined_data_final <- prescriptions_age_ca %>% 
  left_join(Heart2, by = join_by(hbt == hbr))



#making plots



#length(unique(prescriptions[,"HBT"])) 
#length(unique(heart_mortality[,"HBR"])) 
#sorted_unique_values <- sort(unique(CA_HB$HB))
#print(sorted_unique_values)

#one HB in the perscription can be ambulance so have to check the HB code

```

older than 65 is set as "elder" in this case because thats how health guidelines usually define it. So all the age data other than above 65 was filtered out and joined together by HB. Then also filter out for antihypertensive drugs. then also connect HB and join by HB and connect the council area (this file also has council name). So going to analyze by if there is differences in perscription of antihypertensives and the outcome depending on the council area by joining with heart outcome.

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
